<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Number Duel ðŸ’–</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}

body{
height:100vh;
display:flex;
justify-content:center;
align-items:center;
background:linear-gradient(135deg,#ffd6e8,#c8f0ff);
transition:0.4s;
overflow:hidden;
}

.container{
width:420px;
height:760px;
background:white;
border-radius:25px;
box-shadow:0 30px 60px rgba(0,0,0,0.3);
display:flex;
flex-direction:column;
overflow:hidden;
}

.header{
padding:12px;
background:#ff77c8;
color:white;
display:flex;
justify-content:space-between;
align-items:center;
font-weight:bold;
}

.chat{
flex:1;
padding:15px;
overflow-y:auto;
display:flex;
flex-direction:column;
background:#fffafc;
}

.msg{
display:flex;
align-items:center;
margin-bottom:10px;
animation:pop 0.2s ease;
}

@keyframes pop{
from{transform:scale(0.8);opacity:0;}
to{transform:scale(1);opacity:1;}
}

.bubble{
padding:10px 14px;
border-radius:18px;
max-width:70%;
margin-left:6px;
}

.left .bubble{background:#ffe6f2;}
.right .bubble{background:#c8f7ff;}

.avatar{
width:32px;
height:32px;
border-radius:50%;
display:flex;
justify-content:center;
align-items:center;
background:#eee;
font-size:18px;
}

.input-area{
display:flex;
padding:10px;
border-top:1px solid #eee;
}

input{
flex:1;
padding:10px;
border-radius:20px;
border:1px solid #ddd;
}

button{
margin-left:6px;
padding:8px 12px;
border:none;
border-radius:20px;
background:#ff77c8;
color:white;
cursor:pointer;
}

.emoji-bar{
display:flex;
justify-content:center;
gap:8px;
padding:6px;
}

.emoji{
cursor:pointer;
font-size:20px;
transition:0.2s;
}

.emoji:hover{transform:scale(1.3);}

.typing{
font-size:12px;
color:gray;
padding-left:12px;
height:18px;
}

.players{
font-size:12px;
}

.invite{
font-size:11px;
cursor:pointer;
text-decoration:underline;
}
</style>
</head>

<body>

<div class="container">

<div class="header">
<div>
<div id="roomText"></div>
<div class="invite" onclick="copyInvite()">Copy Invite Link</div>
</div>
<div class="players">Online: <span id="playerCount">0</span></div>
</div>

<div class="chat" id="chat"></div>
<div class="typing" id="typing"></div>

<div class="emoji-bar">
<span class="emoji" onclick="react('ðŸ”¥')">ðŸ”¥</span>
<span class="emoji" onclick="react('ðŸ˜‚')">ðŸ˜‚</span>
<span class="emoji" onclick="react('ðŸ˜±')">ðŸ˜±</span>
<span class="emoji" onclick="react('ðŸ’–')">ðŸ’–</span>
<span class="emoji" onclick="react('ðŸ‘‘')">ðŸ‘‘</span>
</div>

<div class="input-area">
<input id="input" type="number" placeholder="1-100">
<button onclick="send()">Send</button>
</div>

</div>

<script>

const params = new URLSearchParams(window.location.search);
let room = params.get("room") || Math.random().toString(36).substr(2,6).toUpperCase();
let player = Math.random().toString(36).substr(2,4).toUpperCase();
let avatar = prompt("Choose avatar emoji ðŸ˜ŽðŸ”¥ðŸ‘‘ðŸ’–") || "ðŸ™‚";

document.getElementById("roomText").innerText="Room: "+room;

const ws = new WebSocket(
  location.protocol === "https:"
    ? `wss://${location.host}`
    : `ws://${location.host}`
);

let secret=null;

ws.onopen=()=>{
ws.send(JSON.stringify({type:"join",room,player,avatar}));
};

ws.onmessage=(event)=>{
const data=JSON.parse(event.data);

if(data.type==="players"){
document.getElementById("playerCount").innerText=data.count;
}

if(data.type==="system"){
addMsg(data.message,data.avatar,"left");
}

if(data.type==="reaction"){
addMsg(data.player+" reacted "+data.emoji,data.avatar,"left");
}

if(data.type==="typing" && data.player!==player){
document.getElementById("typing").innerText=data.player+" typing...";
setTimeout(()=>typing.innerText="",800);
}
};

function addMsg(text,av,side){
let div=document.createElement("div");
div.className="msg "+side;

let avatarDiv=document.createElement("div");
avatarDiv.className="avatar";
avatarDiv.innerText=av;

let bubble=document.createElement("div");
bubble.className="bubble";
bubble.innerText=text;

div.appendChild(avatarDiv);
div.appendChild(bubble);

chat.appendChild(div);
chat.scrollTop=999999;
}

function send(){
let val=parseInt(input.value);
if(!val) return;

if(!secret){
secret=val;
addMsg("Secret selected âœ”",avatar,"right");
}else{
ws.send(JSON.stringify({type:"game",room,player,val,avatar}));
addMsg("Guess: "+val,avatar,"right");
}
input.value="";
}

function react(e){
ws.send(JSON.stringify({type:"reaction",room,player,emoji:e,avatar}));
}

input.addEventListener("input",()=>{
ws.send(JSON.stringify({type:"typing",room,player}));
});

function copyInvite(){
let link=window.location.origin+"?room="+room;
navigator.clipboard.writeText(link);
alert("Invite link copied!");
}

</script>

</body>
</html>
